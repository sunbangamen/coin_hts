# GitHub Issue #37: 실전 백테스트 기준 타임프레임/심볼 통일화

**Issue**: #37
**Status**: OPEN
**Created**: 2025-11-12
**Priority**: 🔴 High

---

## 1. 이슈 정보

### 제목
[Feature] 실전 백테스트 기준 타임프레임/심볼 통일화

### Summary

현재 데이터 관리 UI(DataManagementPage)와 자동 수집 스케줄러가 **서로 다른 심볼/타임프레임 목록**을 사용하여, 실제 백테스트 워크플로에서 **데이터 수집 → 검증 → 백테스트 실행**의 흐름이 끊어져 있습니다. 이를 해결하기 위해 프론트엔드와 백엔드가 같은 심볼/타임프레임을 공유하여, 자동 수집된 데이터가 백테스트 UI에서 즉시 사용 가능하도록 정합성을 확보합니다.

실전 백테스트 요구사항에 맞춰 **분봉(1M, 5M), 시간봉(1H), 일봉(1D), 주봉(1W)** 모두를 지원하고, 원화 코인 기본 리스트(KRW-BTC, KRW-ETH 등)를 프론트엔드 드롭다운과 백엔드 환경 변수에 동기화합니다.

### 관련 파일
- Frontend: `frontend/src/pages/DataManagementPage.jsx`, `frontend/src/pages/BacktestPage.jsx`
- Backend: `backend/app/scheduler.py`, `.env`, `docker-compose.yml`
- 문서: `docs/coin/mvp/fb_22.md`, `docs/AUTOMATED_DATA_COLLECTION_GUIDE.md`

---

## 2. 문제 이해

### 핵심 요구사항
- 프론트엔드 데이터 관리 UI와 백엔드 자동 수집 스케줄러가 서로 다른 심볼/타임프레임 목록 사용
- 실제 백테스트 워크플로의 정합성이 깨져 있음
- 자동 수집 → 파일 저장 → 백테스트 실행의 완전한 워크플로 구현 필요

### 기대 효과
- 자동 수집 → 파일 저장 → 백테스트 실행의 완전한 워크플로 구현
- 프론트엔드 UI에서 오타 방지 (텍스트 입력 → 드롭다운 전환)
- 백엔드 환경 변수로 수집 대상 중앙 관리

### Acceptance Criteria
- [ ] 프론트엔드 DataManagementPage에서 새 타임프레임(1M, 5M, 1W) 선택 가능
- [ ] 프론트엔드 드롭다운에서 모든 DEFAULT_SYMBOLS 심볼 선택 가능
- [ ] 백엔드 환경 변수(SCHEDULER_SYMBOLS, SCHEDULER_TIMEFRAMES)가 설정되고, 스케줄러가 이를 참조
- [ ] 수집된 데이터가 `DATA_ROOT/data/<symbol>/<timeframe>/YEAR.parquet` 형식으로 저장됨
- [ ] Phase 1 Backtest UI에서 수집한 심볼/타임프레임이 백테스트 가능
- [ ] 프론트엔드와 백엔드의 심볼/타임프레임 목록이 항상 동기화됨 (문서 또는 테스트로 보증)
- [ ] (선택) Phase 5의 통합 테스트가 DEFAULT_SYMBOLS/TIMEFRAMES 동기화를 CI에서 검증

---

## 3. 해결 계획

### Phase 0: 현황 분석 (사전 작업)
**작업**:
- `frontend/src/pages/DataManagementPage.jsx` 현재 상수 확인
- `frontend/src/pages/BacktestPage.jsx` 현재 상수 확인
- `backend/app/scheduler.py` 현재 심볼/타임프레임 로딩 방식 확인
- `.env` / `docker-compose.yml` 현재 환경 변수 확인

**산출물**: 현재 상태 요약 문서
**Owner**: FE/BE 리드 공동
**시간**: 30분

---

### Phase 1: 프론트엔드 상수 통일 및 UI 개선
**작업**:
- `DataManagementPage.jsx`에 `DEFAULT_SYMBOLS`와 `TIMEFRAMES` 상수 정의/수정
- 업로드 폼의 심볼 입력을 텍스트 → `<select>` 드롭다운으로 교체
- `BacktestPage.jsx`의 타임프레임 상수도 동일하게 통일
- 심볼 입력 UI 개선 (드롭다운 또는 자동완성)

**산출물**: 수정된 JSX 파일들
**의존성**: Phase 0 완료
**확인 방법**: 브라우저에서 드롭다운 동작 확인
**Owner**: 프론트엔드 담당
**시간**: 4-5시간

---

### Phase 2: 백엔드 환경 변수 기반 설정 구현
**작업**:
- `backend/app/scheduler_config.py` 생성 (또는 기존 config.py에 헬퍼 추가)
- `get_scheduler_symbols()`, `get_scheduler_timeframes()` 함수 구현
- `scheduler.py`, `jobs/data_ingestion.py` 등에서 헬퍼 사용하도록 리팩토링
- `.env` 또는 `docker-compose.yml`에 통일된 환경 변수 추가

**산출물**: 수정된 Python 파일들, 업데이트된 환경 설정 파일
**의존성**: Phase 0 완료 (Phase 1과 병렬 가능)
**확인 방법**: 단위 테스트 작성 및 실행
**Owner**: 백엔드 담당
**시간**: 1-2시간

---

### Phase 3: 동기화 문서 작성
**작업**:
- `docs/coin/mvp/SYMBOL_TIMEFRAME_SYNC_GUIDE.md` 작성
- 프론트엔드/백엔드 정의 위치 명시
- 동기화 체크리스트 제공
- 향후 유지보수 가이드라인 작성

**산출물**: 동기화 가이드 문서
**의존성**: Phase 1, 2 완료
**확인 방법**: 문서 리뷰
**Owner**: 테크 라이터 또는 QA
**시간**: 1시간

---

### Phase 4: E2E 워크플로 검증
**작업**:
- `docs/coin/mvp/BACKTEST_WORKFLOW_VALIDATION.md` 작성
- 실제 워크플로 테스트 (데이터 수집 → 파일 확인 → 백테스트 실행)
- 각 단계별 스크린샷/로그 수집
- 에러 케이스 및 문제 해결 방법 정리

**산출물**: 검증 문서, 테스트 결과 (스케줄러 데이터가 `DATA_ROOT/data/<symbol>/<timeframe>` 구조로 생성되는지 선행 체크리스트 포함)
**의존성**: Phase 1, 2, 3 완료 + 스케줄러 출력 경로 사전 확인
**확인 방법**: 전체 워크플로 수동 테스트
**Owner**: QA + 운영
**시간**: 2-3시간

---

### Phase 5 (선택): 자동화된 동기화 검증 테스트
**작업**:
- `tests/integration/test_symbol_timeframe_sync.py` 작성
- CI/CD 파이프라인에 통합

**산출물**: 통합 테스트 코드
**의존성**: Phase 1, 2, 3, 4 완료
**확인 방법**: 테스트 실행 및 CI 파이프라인 확인
**Owner**: 테스트 자동화 담당
**시간**: 1-2시간

---

## 4. 예상 타임라인

**추천 순서**:
1. **Week 1**: Phase 0 (현황 분석, 30분) + Phase 1 (프론트엔드 UI 수정, 4-5시간)
2. **Week 1**: Phase 2 (백엔드 환경 변수 설정, 1-2시간) - Phase 1과 병렬 가능
3. **Week 2**: Phase 3 (문서화, 1시간)
4. **Week 2**: Phase 4 (워크플로 검증, 2-3시간)
5. **Week 3** (선택): Phase 5 (자동화 테스트, 1-2시간)

**총 예상 소요시간**: 8.5-13.5시간 (Phase 5 제외 시 7.5-11.5시간)

---

## 5. 위험 요소 및 확인 필요 사항

### 1. Phase 1 Backtest UI의 데이터 소스 확인
- **질문**: Phase 1 Backtest 페이지(`frontend/src/pages/BacktestPage.jsx`)가 어디서 심볼/타임프레임 목록을 가져오는가?
- **확인 필요**: 프론트엔드 상수를 참조하는지, 백엔드 API에서 조회하는지
- **조치**: 만약 별도의 하드코딩된 목록을 가지고 있다면, Task 1과 동기화해야 함
- **추적 방법**: Phase 0 산출물에 확인 결과를 기록하고, 필요한 경우 Issue #37 서브태스크(예: FE-037A)로 등록해 책임자 지정

### 2. 자동 스케줄러의 실제 구현 방식 확인
- **질문**: 현재 `backend/app/scheduler.py`에서 심볼/타임프레임을 어디서 가져오는가?
- **확인 필요**: 환경 변수를 이미 사용하고 있는지, 하드코딩되어 있는지
- **조치**: Phase 2의 파싱 로직이 기존 코드와 호환되는지 사전 검토
- **추가 조치**: `.env`, `.env.production`, `docker-compose.yml`에 동일 값이 유지되는지 config-sync 체크리스트 작성

### 3. 데이터 저장 경로와 타임프레임 매핑 확인
- **질문**: 1M(분봉) 데이터가 파일 시스템에서 어떻게 저장되는가?
- **확인 필요**: `DATA_ROOT/data/KRW-BTC/1M/2024.parquet` 형식인지 확인
- **조치**: Parquet 파일의 시간 정밀도(1분 단위 행)가 올바르게 저장되는지 검증
- **추가 조치**: Phase 4 시작 전 `jobs/data_ingestion.py` 로그 캡처 및 실제 파일 스크린샷을 체크리스트에 첨부

### 4. 심볼 다중 선택 UX 설계
- **리스크**: BacktestPage에서 여러 심볼을 동시에 선택해야 하는 경우 UX가 복잡해질 수 있음
- **조치**: 태그 입력/체크박스/멀티 셀렉트 등 적절한 UI 설계 필요
- **불확실성**: 여러 심볼을 동시에 허용할지(쉼표 구분) 여부 명확히 필요
- **추가 조치**: Product와 UX가 멀티 선택 정책을 확정하고 UI 스펙을 `docs/coin/mvp/UX_SPEC.md`에 문서화

### 5. 기존 사용자 마이그레이션
- **리스크**: 기존 코드에서 텍스트 입력으로 임의의 심볼을 입력하던 사용자가 있을 수 있음
- **조치**: 마이그레이션 가이드 문서화 필요
- **추가 조치**: `docs/coin/mvp/SYMBOL_TIMEFRAME_SYNC_GUIDE.md`에 사용자 마이그레이션 섹션 추가하고, 배포 노트에 제한 사항 정리

---

## 6. 확정된 상수

### 기본 심볼 목록 (DEFAULT_SYMBOLS)
```
KRW-BTC, KRW-ETH, KRW-XRP, KRW-SOL, KRW-XLM, KRW-ADA, KRW-DOGE, KRW-BCH, KRW-NEAR
```

### 타임프레임 목록 (TIMEFRAMES)
```
1M (1분), 5M (5분), 1H (1시간), 1D (1일), 1W (1주)
```

---

## 7. 다음 단계

### 진행 범위 확인
- Phase 0-4를 먼저 진행하고, Phase 5(자동화 테스트)는 별도 이슈로 분리할 것을 추천합니다.

### 심볼 목록 확정
이슈에 명시된 기본 심볼 목록이 확정되었습니다.

### 타임프레임 표기법 확정
위 표기법이 최종 확정되었습니다.

### 기존 데이터 마이그레이션
기존에 다른 형식으로 저장된 데이터 여부를 별도로 확인해야 합니다.

### 환경 변수 관리 가이드
- `.env`, `.env.production`, `docker-compose.yml` 모두에서 `SCHEDULER_SYMBOLS`, `SCHEDULER_TIMEFRAMES` 값이 동일한지 체크리스트에 따라 검증하고, 민감 값은 `.env.local` 등 git-ignore 파일로 분리합니다.
- 환경 변수 변경 시 Phase 3 문서와 동기화 가이드에 즉시 반영하고, 배포 전 운영팀이 diff를 검토하여 설정 드리프트를 방지합니다.

### 즉시 실행 액션
- Phase 0에서 식별되는 확인 항목을 Issue #37 하위 태스크(예: FE-037A, BE-037B, QA-037C)로 등록해 오너를 지정합니다.
- 업데이트된 문서를 FE/BE/QA 리드에게 공유하여 오너 및 타임라인 확정을 서명받고, 정기 스탠드업에서 진행 상황을 추적합니다.
- 상기 두 액션을 완료하면 스탠드업 노트에 진행상황을 기록하고, 위임된 서브태스크별 예상 완료일을 README 또는 스프린트 보드에 표시합니다.
