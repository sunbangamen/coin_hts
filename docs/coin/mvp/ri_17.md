# Issue #27 분석 및 해결 계획: [Pre-Phase 3] 운영 보완 전 시스템 검증 및 인프라 정비

## 목차
1. [이슈 정보](#이슈-정보)
2. [문제 이해](#문제-이해)
3. [해결 계획](#해결-계획)
4. [실행 방안](#실행-방안)

---

## 이슈 정보

### 기본 정보
- **이슈 번호**: #27
- **제목**: [Pre-Phase 3] 운영 보완 전 시스템 검증 및 인프라 정비
- **상태**: OPEN (2025-11-08 생성)
- **우선순위**: High (Phase 3 시작 차단)
- **라벨**: `Phase-3-prep`, `testing`, `performance`, `infrastructure`, `high-priority`

### 핵심 내용
Phase 3 운영 보완(비동기 태스크 큐, 외부 스토리지, 운영 가이드) 시작 전에, Phase 1/2에서 완료된 기능들의 안정성과 성능을 검증하고 필요한 데이터/인프라를 정비합니다.

---

## 문제 이해

### 현재 상태
- ✅ Phase 0: MVP Kickoff 완료
- ✅ Phase 1: 전략 입력 & 백테스트 실행 완료 (Issue #5, #25)
- ✅ Phase 2: 시그널 뷰어 & 관리 완료 (Issue #23)
- ⏸️ Phase 3: 운영 보완 시작 대기 중

### 기술 스택
- **Backend**: FastAPI, Python, Docker Compose
- **Frontend**: React, Vite, Recharts
- **Database**: PostgreSQL, Redis
- **Storage**: JSON 파일 기반 결과 저장 (`data/results/`)

### 핵심 요구사항
1. Frontend E2E 테스트를 통한 버그 확인
2. API 성능 벤치마크 수행 및 병목 구간 파악
3. 알려진 이슈 재확인 및 우선순위 분류
4. 데이터/인프라 현황 문서화 및 외부 스토리지 전환 준비
5. Phase 3 전환 준비 완료 리포트 작성

### 성공 기준
- ✅ Task 0~5의 모든 DoD 항목 체크
- ✅ 6개 산출물 문서 작성 완료
- ✅ Frontend E2E 테스트 심각한 버그 발견 0건 (또는 해결 완료)
- ✅ 성능 테스트 SLA 준수 (응답 시간 < 1초, 메모리 사용량 < 2GB)
- ✅ 알려진 이슈 모두 분류 (우선순위 및 처리 대상 명확)
- ✅ 데이터/인프라 정비 완료로 외부 스토리지 전환 준비 완료
- ✅ Phase 3 전환 결정 GO 승인

---

## 해결 계획

### 전제 조건
- Docker Compose 환경 정상 동작 (Backend, Frontend, PostgreSQL, Redis)
- 기존 pytest 75개 이상 통과
- 테스트 데이터 존재 (`data/KRW-BTC/1D/2025.parquet`)

### Task 0: 환경 준비 및 확인 (30분, CRITICAL)

**작업 설명**:
- Docker Compose 전체 스택 기동 및 정상 동작 확인
- Backend API, Frontend Dev Server, Redis, PostgreSQL 정상 동작 확인
- 기존 pytest 75개 이상 통과 + 커버리지 보고서 수집 (`coverage run -m pytest && coverage report`)
- 테스트 데이터 존재 확인 (필수 기본 파일: `data/KRW-BTC/1D/2025.parquet`)
- Task 2 대비 다중 심볼·연속 1년 데이터 생성
  - `python scripts/generate_test_data.py` 실행 → `data/{SYMBOL}/1D/{YEAR}.parquet` 파일 생성 여부 확인
  - 추가 심볼/기간이 필요하면 `scripts/test_performance_phase3.py --symbols "KRW-BTC,KRW-ETH,KRW-XRP" --days 365` 등으로 확장

**산출물**:
- `docs/coin/mvp/ENVIRONMENT_SETUP_CHECKLIST.md`
- 커버리지 리포트 요약 (라인 커버리지 %, 상위 미커버 영역)
- 생성된 데이터 파일 목록 스냅샷 (심볼·기간·행 수)

**확인 방법**:
- Docker 컨테이너 모두 healthy 상태
- `coverage report` 출력에서 라인 커버리지 ≥65% 확인 (미달 시 후속 액션 기록)
- pytest 실행 결과 75개 이상 PASSED
- `ls -lh data/*/1D/*.parquet` 로 각 심볼/연도 파일 존재 확인 (최소 3개 심볼 · 365개 캔들)

**위험 요소**:
- Docker 환경 오염 → `docker compose down -v` 후 재기동
- 데이터 생성 스크립트 실패 → `pip install -r requirements.txt` 재실행 후 로그를 체크리스트에 첨부

---

### Task 1: Frontend E2E 테스트 (2-3시간, HIGH)

**작업 설명**:
- 백테스트 실행 플로우 수동 테스트
  - 전략 선택, 심볼 선택, 날짜 범위 입력
  - 결과 테이블 렌더링 확인 (승률, 평균 수익률, 최대 낙폭, 샘플 수)

- 신호 테이블(SignalsTable) 기능 테스트
  - 신호 목록 렌더링 (30개)
  - 정렬 기능 (timestamp, return_pct, type)
  - 색상 코딩 (양수: 초록, 음수: 빨강)
  - 빈 상태 처리

- 차트 렌더링 테스트
  - Equity Curve, Drawdown, Returns Distribution

- 시그널 뷰어 페이지 테스트 (Phase 2)
  - `/viewer` 경로 접근
  - 최신 결과 자동 로딩 (폴링 5초)
  - 히스토리 목록 표시
  - 심볼별 필터
  - JSON/CSV 다운로드

- 에러 처리 테스트
  - 존재하지 않는 심볼 입력 시 에러 메시지
  - 날짜 범위 오류 시 에러 메시지
  - Backend 중단 시 에러 상태 표시

**산출물**:
- `docs/coin/mvp/FRONTEND_E2E_TEST_RESULTS.md` (테스트 결과, 스크린샷, 발견된 이슈)

**의존성**: Task 0 완료 후 진행

**확인 방법**:
- 각 시나리오별 PASS/FAIL 결과 문서화
- 심각한 버그 0건 또는 해결 완료

---

### Task 2: API 성능 벤치마크 (1-2시간, MEDIUM)

**작업 설명**:
- 사전 준비: Task 0에서 확보한 다중 심볼 1년치 Parquet 데이터를 사용, 누락된 심볼/기간은 즉시 `scripts/generate_test_data.py`로 보충
- 대량 데이터 생성 (1년 365일 OHLCV 데이터)
- 단일 심볼 성능 테스트
  - 1개월 데이터 → 응답 시간 측정
  - 3개월 데이터 → 응답 시간 측정
  - 1년 데이터 → 응답 시간 측정

- 다중 심볼 성능 테스트
  - 3개 심볼 동시 처리
  - 5개 심볼 동시 처리
  - 10개 심볼 동시 처리 (선택사항)

- 동시 요청 테스트 (선택사항)
  - 동시 2개 요청
  - 동시 5개 요청

- 메모리 사용량 모니터링 (`docker stats`)

- **[CRITICAL]** SLA 미준수 케이스를 PASS로 기록하지 않는다. 응답 시간 > 1초 또는 메모리 > 2GB인 케이스는 명확히 FAIL로 표기하고, 그 원인과 Phase 3 개선 계획을 명시한다.

**산출물**:
- `docs/coin/mvp/PERFORMANCE_BENCHMARK_RESULTS.md` (응답 시간, 메모리 사용량, 병목 분석)
  - **필수**: 결과 표에 PASS/FAIL 컬럼 포함
  - **필수**: FAIL 케이스별 근본 원인과 개선 계획 명시 (예: O(n²) 알고리즘, numpy 벡터화로 해결)
- `scripts/performance_test.py` (성능 테스트 스크립트)

**의존성**: Task 0 완료 후, Task 1과 병렬 가능

**확인 방법**:
- 응답 시간 < 1초 (SLA 준수)
- 메모리 사용량 < 2GB
- 병목 구간 파악 (데이터 로딩, 백테스트 계산, JSON 직렬화)
- SLA 미준수 케이스가 있으면, 각 케이스의 FAIL 원인과 Phase 3 우선순위를 명시

---

### Task 3: 알려진 이슈 재확인 (1시간, LOW)

**작업 설명**:
- 이슈 1: 존재하지 않는 심볼 에러 처리 확인
- 이슈 2: Performance Curve drawdown 필드 확인
- 추가 이슈 탐색 (브라우저 Console, Backend 로그)

**산출물**:
- `docs/coin/mvp/KNOWN_ISSUES_STATUS.md` (이슈 상태, 우선순위, Phase 3 처리 목록)

**의존성**: Task 1 완료 후 진행 권장

**확인 방법**:
- 알려진 이슈가 모두 분류됨 (우선순위별)

---

### Task 4: 데이터/인프라 정비 (1-2시간, MEDIUM)

**작업 설명**:
- `data/` 디렉토리 구조 문서화
- 결과 저장 시스템 검증 (`data/results/`, `index.json` 스키마)
- Docker 볼륨 매핑 확인 (`docker-compose.yml`, 환경 변수)
- 외부 스토리지 전환 체크리스트 작성
  - 필요한 데이터 목록
  - 마이그레이션 절차 초안
  - 데이터 백업 계획

**산출물**:
- `docs/coin/mvp/DATA_INFRASTRUCTURE_REPORT.md` (구조 다이어그램, 파일 목록, 전환 체크리스트)

**의존성**: Task 0 완료 후, Task 1, 2와 병렬 가능

**확인 방법**:
- 데이터 구조가 명확히 문서화됨
- 외부 스토리지 전환 체크리스트 작성 완료

---

### Task 5: Phase 3 전환 준비 완료 리포트 (30분, LOW)

**작업 설명**:
- Task 0~4 완료 여부 확인
  - **[CRITICAL]** Task 0~4에서 생성된 6개 산출물의 실존 여부와 경로를 교차 검증한다
  - 각 산출물의 파일명, 크기, 생성 시각을 스냅샷으로 기록한다
  - 산출물이 누락된 경우, 즉시 재실행하거나 보충 작성한다

- 발견된 이슈 요약
  - Frontend E2E 테스트
  - 성능 테스트
  - 알려진 이슈 재확인
  - 데이터/인프라 정비

- **[CRITICAL]** Task별 상태 표 작성
  - 각 Task의 DoD 체크리스트와 실제 완료도를 표 형식으로 정리
  - 각 산출물의 경로, 페이지 수, 주요 결과를 기록
  - Critical/High 우선순위 이슈 개수 합산 (=0이어야 GO 승인 가능)

- Phase 3 전환 결정 (GO/NO-GO)
  - GO 선언 시: "Critical 잔여 이슈 = 0" 명시
  - 만약 Critical 이슈가 존재하면: "NO-GO" 또는 "조건부 GO + 이슈 목록" 명시

**산출물**:
- `docs/coin/mvp/PHASE3_READINESS_REPORT.md` (완료 요약, 이슈 목록, 전환 결정)
  - **필수**: Task 0~4의 산출물 경로 및 실존 여부 표 포함
  - **필수**: Task별 상태 표 (DoD 체크, 완료도, 주요 수치) 포함
  - **필수**: Critical 이슈 합산 및 GO 조건 검증 결과 명시
  - **필수**: Phase 3 시작 조건 명확화 (예: 외부 스토리지 선택 필수, 개발 리소스 할당 필수)

**의존성**: Task 0~4 모두 완료 후 진행

**확인 방법**:
- Task 0~4 산출물 6개 모두 존재 확인 (경로 포함)
- Task별 상태 표가 작성되고 DoD 체크가 완료됨
- Critical 이슈 개수가 0인지 확인 (0이면 GO, 1개 이상이면 NO-GO 또는 조건부 GO)
- Phase 3 전환 결정이 명확히 기록됨 (GO/NO-GO와 그 근거)

---

## 실행 방안

### 예상 일정
- **총 소요 시간**: 6-9시간 (1-2일)
- **권장 진행 순서**:
  - **Day 1 오전**: Task 0 (30분) → Task 1 시작, Task 2 병렬 진행
  - **Day 1 오후**: Task 1 완료, Task 3, Task 4 병렬 진행
  - **Day 2 오전**: Task 2, Task 4 완료, Task 5 최종 리포트

### 의존성 그래프
```
Task 0 (환경 준비)
  ├─→ Task 1 (E2E 테스트)
  │     └─→ Task 3 (알려진 이슈)
  │           └─→ Task 5 (최종 리포트)
  ├─→ Task 2 (성능 테스트) ─┘
  └─→ Task 4 (데이터/인프라) ┘
```

### 리스크 관리

| 리스크 | 상황 | 대응 |
|-------|------|------|
| Docker 환경 오염 | 이전 컨테이너 잔여물로 인한 테스트 실패 | `docker compose down -v && docker compose up -d`로 초기화 |
| 테스트 데이터 부족 | 현재 BTC_KRW 2025 데이터만 존재 | 성능 테스트용 1년 데이터 및 다중 심볼 데이터 생성 |
| 성능 SLA 초과 | 1년 데이터 또는 10개 심볼 처리 시 응답 시간 > 1초 | 병목 구간 파악 후 Phase 3에서 비동기 처리로 해결 |
| 새로운 버그 발견 | E2E 테스트 중 예상치 못한 UI/API 버그 | 우선순위 분류 후 Phase 3 진행 여부 재평가 |

### GO 선언 검증 규칙 (Critical 이슈 합산)

**Phase 3 GO 승인 전 반드시 확인할 사항**:
- [ ] **Critical 잔여 이슈 개수 = 0** (Task 0~4에서 발견된 Critical 이슈가 모두 문서화되었고, 미해결 이슈는 0개인지 확인)
- [ ] **High 우선순위 이슈 개수**: N개 명시 (Phase 3 Week 1에서 처리할 이슈 목록)
- [ ] **산출물 교차 검증 완료**: Task 0~4의 6개 산출물 모두 경로와 함께 나열되고, 실제 파일 존재 확인
- [ ] **Task별 DoD 완료도**: 모든 Task의 DoD 체크리스트가 100% 체크되었는지 검증

**만약 Critical 이슈가 1개 이상 존재하면**:
- "NO-GO: Critical 이슈 N개 존재 (완료 및 문서화 필요)"로 명시
- 또는 "조건부 GO: Critical 이슈 N개를 Phase 3 시작 전에 즉시 해결하고 재검증" 명시

---

## 미해결 질문

1. **보안 검증**
   - CORS 정책, API 인증, 민감 정보 노출을 Phase 3 전에 확인해야 하는가?
   - 제안: 최소한의 보안 체크리스트 확인 후 Phase 3에서 본격 강화

2. **테스트 커버리지 + Critical 이슈 정의**
   - Task 0에서 커버리지 리포트를 수집하지만 GO/NO-GO 기준선(예: 70% 이상)이 확정되지 않음
   - 제안: Phase 2 핵심 모듈(히스토리 관리, 전략 프리셋)의 목표 커버리지를 Phase 3 킥오프 전 합의
   - **[추가]** Critical 이슈의 정의:
     - "Phase 1/2 기능 불가 (버그)" → Critical
     - "성능 SLA 초과 (10초 이상)" → Critical
     - "API 응답 에러 (500 시리즈)" → Critical
     - "인프라 장애" → Critical
   - **[추가]** High 이슈의 정의:
     - "성능 SLA 미준수 (1-10초)" → High
     - "기능 제약 (특정 조건에서만)" → High
     - "테스트 실패 (구현 미완료)" → High
   - **[추가]** GO 판단 기준: Critical = 0, High ≤ 5개, 산출물 6개 완성

3. **사용자 문서**
   - README/운영 가이드가 Phase 1/2 기능을 반영하는가?
   - 제안: Phase 3에서 운영 가이드 작성 시 함께 업데이트

4. **외부 스토리지 선택**
   - OneDrive, NFS, S3 중 어떤 스토리지를 사용할지 결정 필요
   - 제안: Task 4에서 각 옵션의 장단점 정리 후 결정

5. **비동기 태스크 큐 기술 선택**
   - Celery vs RQ vs FastAPI BackgroundTasks 중 선택 필요
   - 제안: Phase 3 시작 전 기술 조사 및 선정 완료

---

## 관련 문서

- 상세 테스트 절차: `docs/coin/mvp/phase3_testing_guide.md`
- Phase 1 완료 리포트: `docs/coin/mvp/PHASE1_COMPLETION_REPORT.md`
- Phase 2 완료 상태: `docs/coin/mvp/ri_15.md`
- 전체 Phase 계획: `docs/coin/mvp_phase.md`

---

## 산출물 목록

이슈 완료 시 다음 6개 문서가 생성됩니다:

1. **`docs/coin/mvp/ENVIRONMENT_SETUP_CHECKLIST.md`** (Task 0)
   - Docker 상태, pytest 결과, 테스트 데이터 현황
   - **최종 보고 시**: 실제 파일 경로 및 존재 여부 첨부 (예: ls -lh 스냅샷)
   - **최종 보고 시**: pytest 통과 개수 및 버전 명시

2. **`docs/coin/mvp/FRONTEND_E2E_TEST_RESULTS.md`** (Task 1)
   - API 엔드포인트 검증, 에러 로그, 성능 평가
   - **최종 보고 시**: 실제 파일 경로 및 존재 여부 첨부

3. **`docs/coin/mvp/PERFORMANCE_BENCHMARK_RESULTS.md`** (Task 2)
   - 6개 성능 테스트 결과, PASS/FAIL 표, 병목 분석
   - **최종 보고 시**: 실제 파일 경로 및 존재 여부 첨부
   - **필수**: SLA 미준수 케이스의 FAIL 근거와 개선 계획 명시

4. **`docs/coin/mvp/KNOWN_ISSUES_STATUS.md`** (Task 3)
   - 발견된 이슈 6개, 우선순위 분류, Phase 3 처리 계획
   - **최종 보고 시**: 실제 파일 경로 및 존재 여부 첨부
   - **필수**: Critical 이슈 개수 명시 (= 0이어야 GO 가능)

5. **`docs/coin/mvp/DATA_INFRASTRUCTURE_REPORT.md`** (Task 4)
   - 데이터 구조, Docker 인프라, 외부 스토리지 마이그레이션 계획
   - **최종 보고 시**: 실제 파일 경로 및 존재 여부 첨부

6. **`docs/coin/mvp/PHASE3_READINESS_REPORT.md`** (Task 5)
   - **필수**: Task 0~4의 산출물 경로 및 실존 여부 표 포함
   - **필수**: Task별 상태 표 (DoD 체크, 완료도, 주요 수치) 포함
   - **필수**: Critical 이슈 요약 및 개수 명시
   - **필수**: GO/NO-GO 결정 (Critical 개수 = 0이면 GO, 1+ 이면 NO-GO 또는 조건부 GO)
   - **필수**: Phase 3 시작 조건 명확화 (예: 외부 스토리지 선택, 개발 리소스 할당)

**추가 산출물**:
- `scripts/performance_test.py` (성능 테스트 스크립트)
  - **최종 보고 시**: 실제 파일 경로 및 실행 가능 여부 확인
